# π“‹ TimeCapsule ν”„λ΅μ νΈ κ°λ° λ΅λ“λ§µ

## π― **ν„μ¬ μƒνƒ λ¶„μ„**

### β… **μ™„λ£λ κΈ°λ¥λ“¤**
- **μΈμ¦/μΈκ°€ μ‹μ¤ν…** (JWT, Security)
- **μ‚¬μ©μ κ΄€λ¦¬** (νμ›κ°€μ…, λ§μ΄νμ΄μ§€)
- **νƒ€μ„μΊ΅μ CRUD** (μƒμ„±, μ΅°ν, μμ •, μ‚­μ )
- **λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„** (μ—”ν‹°ν‹°, μ—°κ΄€κ΄€κ³„)
- **API λ¬Έμ„ν™”** (Swagger)
- **Docker μΈν”„λΌ** (MySQL, Redis, Prometheus, Grafana)
- **π“¦ DeliveryService μ™„μ „ κµ¬ν„** (λ°μ†΅ λ΅μ§, μƒνƒ κ΄€λ¦¬, λ°°μΉ μ²λ¦¬)
- **π DeliveryController κµ¬ν„** (λ°μ†΅ κ΄€λ¦¬ API)
- **π“ DeliveryLogResponse DTO** (λ°μ†΅ μ΄λ ¥ μ‘λ‹µ)
- **π—‚οΈ μ•„ν‚¤ν…μ² λ¦¬ν©ν† λ§** (μ±…μ„ λ¶„λ¦¬: CapsuleService β†” DeliveryService)

### β **λ―Έκµ¬ν„ ν•µμ‹¬ κΈ°λ¥λ“¤**
- **μ¤μΌ€μ¤„λ¬ μ‹μ¤ν…** (μλ™ λ°μ†΅ νΈλ¦¬κ±°)
- **μ•λ¦Ό μ‹μ¤ν…** (μ΄λ©”μΌ, WebSocket)
- **νμΌ μ—…λ΅λ“/λ‹¤μ΄λ΅λ“**
- **λ¨λ‹ν„°λ§ μ‹μ¤ν…**

---

## π€ **λ‹¨κ³„λ³„ κ°λ° κ³„ν**

### **1λ‹¨κ³„: ν•µμ‹¬ κΈ°λ¥ μ™„μ„±** (μ°μ„ μμ„: π”¥ λ†’μ)

#### **1.1 μ¤μΌ€μ¤„λ¬ μ‹μ¤ν… κµ¬ν„**
```java
// λ‹¤μ κµ¬ν„ λ€μƒ
- CapsuleScheduler.processExpiredCapsules() 
- SchedulerService μμ΅΄μ„± μ£Όμ… λ° λ΅μ§
- @Scheduled μ–΄λ…Έν…μ΄μ… ν™μ©
- DeliveryServiceμ™€ μ—°λ™
```

#### **~~1.2 DeliveryService κµ¬ν„~~** β… **μ™„λ£**
```java
// β… κµ¬ν„ μ™„λ£λ κΈ°λ¥λ“¤
- β… μΊ΅μ μƒνƒ λ³€κ²½ (SCHEDULED β†’ DELIVERED/FAILED)
- β… μ—λ¬ μ²λ¦¬ λ° μ¬μ‹λ„ λ΅μ§
- β… λ°°μΉ λ°μ†΅ μ²λ¦¬
- β… λ°μ†΅ μ΄λ ¥ κ΄€λ¦¬
- β… DeliveryController API μ—”λ“ν¬μΈνΈ
```

#### **1.3 μ΄λ©”μΌ μ•λ¦Ό μ‹μ¤ν…**
```java
// JavaMailSender κµ¬ν„
- SMTP μ„¤μ • (Gmail, AWS SES λ“±)
- μ΄λ©”μΌ ν…ν”λ¦Ώ μ‘μ„±
- λ°μ†΅ μ„±κ³µ/μ‹¤ν¨ μ²λ¦¬
```

#### **1.4 WebSocket μ‹¤μ‹κ°„ μ•λ¦Ό**
```java
// SimpMessagingTemplate κµ¬ν„
- ν΄λΌμ΄μ–ΈνΈ μ—°κ²° κ΄€λ¦¬
- μ‹¤μ‹κ°„ μ•λ¦Ό μ „μ†΅
- κµ¬λ…/ν•΄μ  μ²λ¦¬
```

---

### **2λ‹¨κ³„: μ‚¬μ©μ κ²½ν— κ°μ„ ** (μ°μ„ μμ„: π΅ μ¤‘κ°„)

#### **2.1 νμΌ μ—…λ΅λ“/λ‹¤μ΄λ΅λ“**
- μ²¨λ¶€νμΌ μ—…λ΅λ“ API
- νμΌ μ €μ¥μ† κµ¬ν„ (λ΅μ»¬/AWS S3)
- νμΌ κ²€μ¦ λ° λ³΄μ•

#### **~~2.2 DeliveryController κµ¬ν„~~** β… **μ™„λ£**
- β… λ°μ†΅ λ€μƒ μΊ΅μ μ΅°ν API (`GET /api/delivery/due`)
- β… μΊ΅μ μλ™ λ°μ†΅ API (`POST /api/delivery/dispatch/{capsuleId}`)
- β… λ°°μΉ λ°μ†΅ API (`POST /api/delivery/batch`)
- β… μΊ΅μ μƒνƒ λ³€κ²½ API (`PATCH /api/delivery/status/{capsuleId}`)
- β… λ°μ†΅ μ΄λ ¥ μ΅°ν API (`GET /api/delivery/logs/{capsuleId}`)

#### **2.3 μ„¤μ • νμΌ μ •λ¦¬**
- `application.yml` μ£Όμ„ ν•΄μ 
- ν™κ²½λ³„ μ„¤μ • λ¶„λ¦¬

---

### **3λ‹¨κ³„: μ΄μ μµμ ν™”** (μ°μ„ μμ„: πΆ λ‚®μ)

#### **3.1 λ¨λ‹ν„°λ§ μ‹μ¤ν…**
- Prometheus λ©”νΈλ¦­ κµ¬ν„
- Grafana λ€μ‹λ³΄λ“
- Actuator μ—”λ“ν¬μΈνΈ

#### **3.2 ν…μ¤νΈ μ½”λ“ ν™•μ¥**
- λ‹¨μ„ ν…μ¤νΈ
- ν†µν•© ν…μ¤νΈ
- E2E ν…μ¤νΈ

#### **3.3 μ„±λ¥ μµμ ν™”**
- μΊμ‹± μ „λµ (Redis)
- λ°μ΄ν„°λ² μ΄μ¤ μΈλ±μ¤ μµμ ν™”
- λΉ„λ™κΈ° μ²λ¦¬

---

## π― **λ‹¤μ λ‹¨κ³„ μ¶”μ²**

### **μ¦‰μ‹ κµ¬ν„ν•΄μ•Ό ν•  ν•­λ©:**
1. **CapsuleScheduler κµ¬ν„** - νƒ€μ„μΊ΅μ μλ™ λ°μ†΅μ ν•µμ‹¬ β­ **μµμ°μ„ **
2. **EmailNotificationService μ™„μ„±** - μ‚¬μ©μ μ•λ¦Ό
3. **WebSocketService κµ¬ν„** - μ‹¤μ‹κ°„ μ•λ¦Ό

### **κµ¬ν„ μμ„:**
```
CapsuleScheduler β†’ EmailNotificationService β†’ WebSocketService
```

### **β΅ ν„μ¬ μ§„ν–‰ μƒν™©:**
- β… **DeliveryService μ™„μ „ κµ¬ν„λ¨** - λ°μ†΅ λ΅μ§μ μ¤‘μ‹¬ μ™„λ£
- β… **DeliveryController μ™„μ „ κµ¬ν„λ¨** - λ°μ†΅ κ΄€λ¦¬ API μ™„λ£
- π”„ **λ‹¤μ λ‹¨κ³„: CapsuleScheduler** - μλ™ λ°μ†΅ μ‹μ¤ν… κµ¬ν„

---

## π“ **μ„Έλ¶€ κµ¬ν„ μ²΄ν¬λ¦¬μ¤νΈ**

### **1λ‹¨κ³„ μ²΄ν¬λ¦¬μ¤νΈ**
- [ ] CapsuleScheduler.processExpiredCapsules() κµ¬ν„
- [ ] SchedulerService μμ΅΄μ„± μ£Όμ… λ° λ΅μ§ κµ¬ν„
- [x] ~~DeliveryService ν•µμ‹¬ λ°μ†΅ λ΅μ§ κµ¬ν„~~ β…
- [ ] JavaMailSender μ„¤μ • λ° μ΄λ©”μΌ λ°μ†΅ κµ¬ν„
- [ ] SimpMessagingTemplate WebSocket κµ¬ν„

### **2λ‹¨κ³„ μ²΄ν¬λ¦¬μ¤νΈ**
- [ ] νμΌ μ—…λ΅λ“ API κµ¬ν„
- [ ] νμΌ μ €μ¥μ† κµ¬ν„
- [x] ~~DeliveryController API κµ¬ν„~~ β…
- [ ] application.yml μ„¤μ • μ •λ¦¬

### **3λ‹¨κ³„ μ²΄ν¬λ¦¬μ¤νΈ**
- [ ] Prometheus λ©”νΈλ¦­ κµ¬ν„
- [ ] Grafana λ€μ‹λ³΄λ“ μ„¤μ •
- [ ] ν…μ¤νΈ μ½”λ“ μ‘μ„±
- [ ] μ„±λ¥ μµμ ν™”

---

## π”§ **κΈ°μ  μ¤νƒ**

### **λ°±μ—”λ“**
- Spring Boot 3.5.3
- Spring Security (JWT)
- Spring Data JPA
- MySQL 8.0
- Redis

### **λ¨λ‹ν„°λ§ & μ΄μ**
- Docker & Docker Compose
- Prometheus
- Grafana
- Swagger/OpenAPI

### **μ•λ¦Ό μ‹μ¤ν…**
- JavaMailSender (SMTP)
- WebSocket (STOMP)

---

---

## π **μµκ·Ό μ™„λ£ μ‚¬ν•­** (2025-08-04)

### **π€ DeliveryService & Controller μ™„μ „ κµ¬ν„**
- β… **DeliveryService** μΈν„°νμ΄μ¤ λ° κµ¬ν„μ²΄ μ™„μ„±
- β… **DeliveryServiceImpl** ν•µμ‹¬ λ°μ†΅ λ΅μ§ κµ¬ν„
- β… **DeliveryController** 5κ° API μ—”λ“ν¬μΈνΈ μ™„μ„±
- β… **DeliveryLogResponse** DTO κµ¬ν„
- β… **μ•„ν‚¤ν…μ² λ¦¬ν©ν† λ§** - CapsuleServiceμ—μ„ λ°μ†΅ μ±…μ„ λ¶„λ¦¬
- β… **DeliveryLogRepository** findByCapsuleId λ©”μ„λ“ μ¶”κ°€
- β… **μ»΄νμΌ μ¤λ¥ ν•΄κ²°** λ° μ „μ²΄ μ‹μ¤ν… μ•μ •μ„± ν™•λ³΄

### **π“ μ§„ν–‰λ¥ **
- **μ „μ²΄ ν”„λ΅μ νΈ**: ~70% μ™„λ£
- **1λ‹¨κ³„ (ν•µμ‹¬ κΈ°λ¥)**: ~60% μ™„λ£
- **2λ‹¨κ³„ (μ‚¬μ©μ κ²½ν—)**: ~40% μ™„λ£

### **π― λ‹¤μ λ§μΌμ¤ν†¤**
**CapsuleScheduler κµ¬ν„** - νƒ€μ„μΊ΅μ μλ™ λ°μ†΅ μ‹μ¤ν…μ ν•µμ‹¬

---

**Last Updated:** 2025-08-04